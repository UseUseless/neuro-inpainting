"""
–ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞.
"""

import torch
from pathlib import Path

# ==============================================================================
# üìÇ 1. –ü–£–¢–ò
# ==============================================================================
BASE_DIR = Path(__file__).parent

INPUT_DIR = BASE_DIR / "images_input"
OUTPUT_DIR = BASE_DIR / "images_cleaned"
LOG_DIR = BASE_DIR / "logs"
MODELS_DIR = BASE_DIR / "models"
TEMP_DIR = BASE_DIR / "temp_download"

TRAIN_DATASET_DIR = BASE_DIR / "train_dataset"
BACKGROUNDS_DIR = BASE_DIR / "backgrounds"
BACKGROUNDS_URL = "http://images.cocodataset.org/zips/val2017.zip"
WATERMARK_SOURCE = BASE_DIR / "watermark.png"

# ==============================================================================
# üé® 2. –ù–ê–°–¢–†–û–ô–ö–ò –ì–ï–ù–ï–†–ê–¢–û–†–ê (SYNTHETIC DATA)
# ==============================================================================
GEN_TOTAL_COUNT = 5000          # –í—Å–µ–≥–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å (Train + Val)
GEN_TRAIN_RATIO = 0.8           # –î–æ–ª—è –æ–±—É—á–µ–Ω–∏—è (0.8 = 80%)

# --- –ì–µ–æ–º–µ—Ç—Ä–∏—è –∏ –í–∏–¥–∏–º–æ—Å—Ç—å ---
GEN_SOURCE_REPAIR_DILATION = 2  # –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–π –≤–∞—Ç–µ—Ä–º–∞—Ä–∫–∏ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∏–∫—Å–µ–ª–µ–π
GEN_OPACITY_RANGE = (0.05, 0.95)# –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å: (–º–∏–Ω, –º–∞–∫—Å). 0.05=–ø—Ä–∏–∑—Ä–∞–∫, 0.95=—á–µ—Ç–∫–æ
GEN_SCALE_RANGE = (0.15, 0.85)  # –†–∞–∑–º–µ—Ä: (–º–∏–Ω, –º–∞–∫—Å) –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —à–∏—Ä–∏–Ω—ã —Ñ–æ–Ω–∞
GEN_ROTATION_PROB = 0.5         # –®–∞–Ω—Å –ø–æ–≤–æ—Ä–æ—Ç–∞ –Ω–∞ 90¬∞ (0.5 = 50%)

# --- –¶–≤–µ—Ç –∏ –ò—Å–∫–∞–∂–µ–Ω–∏—è ---
GEN_INVERT_PROB = 0.3           # –®–∞–Ω—Å –∏–Ω–≤–µ—Ä—Å–∏–∏ (–ß–µ—Ä–Ω—ã–π <-> –ë–µ–ª—ã–π)
GEN_BLUR_PROB = 0.5             # –®–∞–Ω—Å —Ä–∞–∑–º—ã—Ç–∏—è (–∏–º–∏—Ç–∞—Ü–∏—è —Ä–∞—Å—Ñ–æ–∫—É—Å–∞/—Å–∂–∞—Ç–∏—è)
GEN_COLOR_PROB = 0.3            # –®–∞–Ω—Å —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ (–∫—Ä–∞—Å–Ω—ã–π, —Å–∏–Ω–∏–π –∏ —Ç.–¥.)

# ==============================================================================
# üèãÔ∏è 3. –ù–ê–°–¢–†–û–ô–ö–ò –û–ë–£–ß–ï–ù–ò–Ø (YOLO Training)
# ==============================================================================
TRAIN_EPOCHS = 100          # –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–≥–Ω–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç
TRAIN_BATCH = 8             # –†–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ (—É–º–µ–Ω—å—à–∏ –¥–æ 4, –µ—Å–ª–∏ –º–∞–ª–æ VRAM)
TRAIN_IMG_SIZE = 640        # –†–∞–∑–º–µ—Ä –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏
TRAIN_PATIENCE = 15         # –û—Å—Ç–∞–Ω–æ–≤–∫–∞, –µ—Å–ª–∏ –Ω–µ—Ç —É–ª—É—á—à–µ–Ω–∏–π
TRAIN_WORKERS = 0           # –î–ª—è Windows –≤—Å–µ–≥–¥–∞ 0

# –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—É)
TRAIN_MOSAIC = 1.0          # –°–º–µ—à–∏–≤–∞–Ω–∏–µ 4 —Ñ–æ—Ç–æ (–≤–∞–∂–Ω–æ!)
TRAIN_HSV_H = 0.015         # –°–¥–≤–∏–≥ –æ—Ç—Ç–µ–Ω–∫–∞
TRAIN_HSV_S = 0.7           # –°–¥–≤–∏–≥ –Ω–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç–∏
TRAIN_HSV_V = 0.4           # –°–¥–≤–∏–≥ —è—Ä–∫–æ—Å—Ç–∏ (–í–∞–∂–Ω–æ –¥–ª—è —Ç–µ–º–Ω—ã—Ö –ª–æ–≥–æ!)
TRAIN_SCALE = 0.5           # –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (+/- 50%)

# ==============================================================================
# üïµÔ∏è 4. –ù–ê–°–¢–†–û–ô–ö–ò –î–ï–¢–ï–ö–¢–û–†–ê (Inference)
# ==============================================================================
YOLO_MODEL_NAME = "yolo11n-seg.pt"
YOLO_MODEL_PATH = MODELS_DIR / "best.pt"
YOLO_CONFIDENCE = 0.45

# CLAHE (–£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ –ø–µ—Ä–µ–¥ –¥–µ—Ç–µ–∫—Ü–∏–µ–π)
DETECTOR_CLAHE_CLIP = 3.0   # –°–∏–ª–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ (2.0 –º—è–≥–∫–æ, 4.0 –∂–µ—Å—Ç–∫–æ)
DETECTOR_CLAHE_GRID = 8     # –†–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏ (8x8)

# ==============================================================================
# üßº 5. –ù–ê–°–¢–†–û–ô–ö–ò –û–ß–ò–°–¢–ö–ò (LaMa)
# ==============================================================================
LAMA_MODEL_NAME = "big-lama"
CLEANER_MASK_DILATION = 6   # –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–∞—Å–∫–∏ (px)

# ==============================================================================
# ‚öôÔ∏è –°–ò–°–¢–ï–ú–ê
# ==============================================================================
DEVICE = "cuda" if torch.cuda.is_available() else "cpu"
# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
VALID_EXTENSIONS = {".jpg", ".jpeg", ".png", ".webp", ".bmp"}

def setup_directories():
    for path in [INPUT_DIR, OUTPUT_DIR, LOG_DIR, MODELS_DIR, TRAIN_DATASET_DIR, BACKGROUNDS_DIR, TEMP_DIR]:
        path.mkdir(parents=True, exist_ok=True)

setup_directories()